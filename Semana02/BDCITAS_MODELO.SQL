
-- =============================================
-- Creación de la Base de Datos
-- =============================================

USE master;
go

IF( EXISTS ( SELECT name FROM master.sys.databases WHERE name = 'BDCITAS' ) )
BEGIN
	DROP DATABASE BDCITAS;
END;
go

CREATE DATABASE BDCITAS;
go


-- =============================================
-- Seleccionar la Base de Datos
-- =============================================

USE BDCITAS;


-- =============================================
-- Creación de tablas
-- =============================================


CREATE TABLE PACIENTE
( 
	IDPACIENTE           integer IDENTITY ( 1,1 ) ,
	NOMBRE               varchar(100)  NOT NULL ,
	APELLIDO             varchar(100)  NOT NULL ,
	DNI                  varchar(20)  NOT NULL ,
	CELULAR              varchar(20)  NOT NULL ,
	CORREO               varchar(100)  NULL ,
	CONSTRAINT XPKPACIENTE PRIMARY KEY (IDPACIENTE ASC)
)
go



CREATE TABLE CALENDARIO
( 
	IDCALENDARIO         integer IDENTITY ( 1,1 ) ,
	ANIO                 integer  NOT NULL ,
	FECHA                datetime  NOT NULL ,
	TIPO                 integer  NOT NULL 
	CONSTRAINT CHK_CALENDARIO_TIPO_1867075250
		CHECK  ( [TIPO]=1 OR [TIPO]=2 OR [TIPO]=3 OR [TIPO]=4 ),
	DESCRIPCION          varchar(500)  NOT NULL ,
	CONSTRAINT XPKCALENDARIO PRIMARY KEY (IDCALENDARIO ASC)
)
go



CREATE TABLE ESPECIALIDAD
( 
	IDESPECIALIDAD       integer  NOT NULL ,
	NOMBRE               varchar(100)  NOT NULL ,
	PACIENTES            integer  NOT NULL ,
	CONSTRAINT XPKESPECIALIDAD PRIMARY KEY (IDESPECIALIDAD ASC)
)
go



CREATE TABLE EMPLEADO
( 
	IDEMPLEADO           integer IDENTITY ( 1,1 ) ,
	APELLIDO             varchar(100)  NOT NULL ,
	NOMBRE               varchar(100)  NOT NULL ,
	IDESPECIALIDAD       integer  NOT NULL ,
	DNI                  varchar(20)  NOT NULL ,
	CELULAR              varchar(20)  NOT NULL ,
	CORREO               varchar(100)  NULL ,
	CONSTRAINT XPKEMPLEADO PRIMARY KEY (IDEMPLEADO ASC),
	CONSTRAINT FK_EMPLEADO_ESPECIALIDAD FOREIGN KEY (IDESPECIALIDAD) REFERENCES ESPECIALIDAD(IDESPECIALIDAD)
		ON DELETE NO ACTION
		ON UPDATE NO ACTION
)
go



CREATE TABLE CONSULTORIO
( 
	IDCONSULTORIO        integer IDENTITY ( 1,1 ) ,
	NOMBRE               varchar(100)  NOT NULL ,
	PISO                 integer  NOT NULL ,
	NUMERO               integer  NOT NULL ,
	ACTIVO               integer  NOT NULL 
	CONSTRAINT DF_CONSULTORIO_ACTIVO_1
		 DEFAULT  1
	CONSTRAINT CHK_CONSULTORIO_ACTIVO
		CHECK  ( [ACTIVO]=0 OR [ACTIVO]=1 ),
	CONSTRAINT XPKCONSULTORIO PRIMARY KEY (IDCONSULTORIO ASC)
)
go



CREATE TABLE TURNO
( 
	IDTURNO              integer  NOT NULL ,
	NOMBRE               varchar(20)  NOT NULL ,
	INICIA               varchar(20)  NOT NULL ,
	FINALIZA             varchar(20)  NOT NULL ,
	CONSTRAINT XPKTURNO PRIMARY KEY (IDTURNO ASC)
)
go



CREATE TABLE HORARIO
( 
	IDHORARIO            integer IDENTITY ( 1,1 ) ,
	IDCALENDARIO         integer  NOT NULL ,
	IDEMPLEADO           integer  NOT NULL ,
	IDCONSULTORIO        integer  NOT NULL ,
	IDTURNO              integer  NOT NULL ,
	PACIENTES            integer  NULL ,
	CITADOS              integer  NULL ,
	ACTIVO               integer  NOT NULL 
	CONSTRAINT DF_HORARIO_ACTIVO_1
		 DEFAULT  1
	CONSTRAINT CHK_HORARIO_ACTIVO
		CHECK  ( [ACTIVO]=0 OR [ACTIVO]=1 ),
	CONSTRAINT XPKHORARIO PRIMARY KEY (IDHORARIO ASC),
	CONSTRAINT FK_HORARIO_CALENDARIO FOREIGN KEY (IDCALENDARIO) REFERENCES CALENDARIO(IDCALENDARIO)
		ON DELETE NO ACTION
		ON UPDATE NO ACTION,
CONSTRAINT FK_HORARIO_EMPLEADO FOREIGN KEY (IDEMPLEADO) REFERENCES EMPLEADO(IDEMPLEADO)
		ON DELETE NO ACTION
		ON UPDATE NO ACTION,
CONSTRAINT FK_HORARIO_CONSULTORIO FOREIGN KEY (IDCONSULTORIO) REFERENCES CONSULTORIO(IDCONSULTORIO)
		ON DELETE NO ACTION
		ON UPDATE NO ACTION,
CONSTRAINT FK_HORARIO_TURNO FOREIGN KEY (IDTURNO) REFERENCES TURNO(IDTURNO)
		ON DELETE NO ACTION
		ON UPDATE NO ACTION
)
go



CREATE TABLE USUARIO
( 
	IDEMPLEADO           integer  NOT NULL ,
	USUARIO              varchar(20)  NOT NULL ,
	CLAVE                varchar(20)  NOT NULL ,
	ACTIVO               integer  NOT NULL 
	CONSTRAINT DF_USUARIO_ACTIVO_1
		 DEFAULT  1
	CONSTRAINT CHK_USUARIO_ACTIVO
		CHECK  ( [ACTIVO]=0 OR [ACTIVO]=1 ),
	CONSTRAINT XPKUSUARIO PRIMARY KEY (IDEMPLEADO ASC),
	CONSTRAINT R_2 FOREIGN KEY (IDEMPLEADO) REFERENCES EMPLEADO(IDEMPLEADO)
		ON DELETE NO ACTION
		ON UPDATE NO ACTION
)
go



CREATE TABLE CITA
( 
	IDCITA               integer IDENTITY ( 1,1 ) ,
	IDPACIENTE           integer  NOT NULL ,
	IDHORARIO            integer  NOT NULL ,
	IMPORTE              numeric(10,2)  NOT NULL ,
	FECHAREGISTRO        datetime  NOT NULL ,
	EMPLEADO             integer  NOT NULL ,
	FECHAATENCION        datetime  NULL ,
	MEDICO               integer  NULL ,
	ESTADO               integer  NOT NULL 
	CONSTRAINT CHK_CITA_ESTADO_523264498
		CHECK  ( [ESTADO]=1 OR [ESTADO]=2 OR [ESTADO]=3 ),
	CONSTRAINT XPKCITA PRIMARY KEY (IDCITA ASC),
	CONSTRAINT FK_CITA_PACIENTE FOREIGN KEY (IDPACIENTE) REFERENCES PACIENTE(IDPACIENTE)
		ON DELETE NO ACTION
		ON UPDATE NO ACTION,
CONSTRAINT FK_CITA_HORARIO FOREIGN KEY (IDHORARIO) REFERENCES HORARIO(IDHORARIO)
		ON DELETE NO ACTION
		ON UPDATE NO ACTION,
CONSTRAINT FK_CITA_EMPLEADO FOREIGN KEY (EMPLEADO) REFERENCES USUARIO(IDEMPLEADO)
		ON DELETE NO ACTION
		ON UPDATE NO ACTION,
CONSTRAINT FK_CITA_MEDICO FOREIGN KEY (MEDICO) REFERENCES USUARIO(IDEMPLEADO)
		ON DELETE NO ACTION
		ON UPDATE NO ACTION
)
go



CREATE TABLE PARAMETRO
( 
	IDPARAMETRO          integer  NOT NULL ,
	NOMBRE               varchar(100)  NOT NULL ,
	VALOR                varchar(100)  NULL ,
	CONSTRAINT XPKPARAMETRO PRIMARY KEY (IDPARAMETRO ASC)
)
go


